#[derive(Debug)]
pub enum RedisEntryId {
    UserSpecifiedID {
        milliseconds: String,
        sequence_number: String,
    },
    AutoGeneratedID,
    AfterLastID,
    /// Applicable only with consumer groups
    UndeliveredEntryID,
}

impl From<RedisEntryId> for fred::types::XID {
    fn from(id: RedisEntryId) -> Self {
        use fred::types::XID;

        match id {
            RedisEntryId::UserSpecifiedID {
                milliseconds,
                sequence_number,
            } => XID::Manual(fred::bytes_utils::format_bytes!(
                "{milliseconds}-{sequence_number}"
            )),
            RedisEntryId::AutoGeneratedID => XID::Auto,
            RedisEntryId::AfterLastID => XID::Max,
            RedisEntryId::UndeliveredEntryID => XID::NewInGroup,
        }
    }
}

impl From<&RedisEntryId> for fred::types::XID {
    fn from(id: &RedisEntryId) -> Self {
        use fred::types::XID;

        match id {
            RedisEntryId::UserSpecifiedID {
                milliseconds,
                sequence_number,
            } => XID::Manual(fred::bytes_utils::format_bytes!(
                "{milliseconds}-{sequence_number}"
            )),
            RedisEntryId::AutoGeneratedID => XID::Auto,
            RedisEntryId::AfterLastID => XID::Max,
            RedisEntryId::UndeliveredEntryID => XID::NewInGroup,
        }
    }
}

#[derive(Eq, PartialEq)]
pub enum SetNXReply {
    KeySet,
    KeyNotSet, // Existing key
}

impl fred::types::FromRedis for SetNXReply {
    fn from_value(value: fred::types::RedisValue) -> Result<Self, fred::error::RedisError> {
        match value {
            // Returns String ( "OK" ) in case of success
            fred::types::RedisValue::String(_) => Ok(SetNXReply::KeySet),
            // Return Null in case of failure
            fred::types::RedisValue::Null => Ok(SetNXReply::KeyNotSet),
            // Unexpected behaviour
            _ => Err(fred::error::RedisError::new(
                fred::error::RedisErrorKind::Unknown,
                "Unexpected SETNX command reply",
            )),
        }
    }
}
